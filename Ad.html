<html>

<head>
	<script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>  
</head>

<body>
	<a-scene>
		<a-plane position="0 -0 -4" rotation="-90 0 0" width="80" height="80" color="brown"></a-plane>
		<a-sky color="rgb(200,200,255)"></a-sky>
		<a-camera look-controls="pointerLockEnabled:true">
			<a-cursor>
				<a-text></a-text>
			</a-cursor>
		</a-camera>
	</a-scene>


	<script>
	let enemies = []
	let scene = document.querySelector("a-scene")
	let camera = document.querySelector("a-camera")
	let cameraPos = camera.getAttribute("position")

	let walls = []

	let birdseye = false
	let text = document.querySelector("a-text")
	text.setAttribute("color", "#000000") 
	text.setAttribute("scale", "1.5 1.5 1.5")
	text.setAttribute("position", `-1.0 1.0 -0.5`)

		

	window.onload = function() {


		walls.push(new Wall(x = 2, z = 4, width = 2, length = 18, "green"))
		walls.push(new Wall(x = 2, z = 3, width = 20, length = 2, "purple"))
		walls.push(new Wall(x = 2, z = -10, width = 35, length = 2, "blue"))
		walls.push(new Wall(x = 4, z = 12, width = 28, length = 2, "red"))
		walls.push(new Wall(x = 2, z = -6, width = 24, length = 2, "orange"))
		walls.push(new Wall(x = 13, z = 3, width = 2, length = 12, "gold"))
		walls.push(new Wall(x = -9, z = 3, width = 2, length = 12, "cyan"))
		walls.push(new Wall(x = -14, z = 5, width = 2, length = 31, "black"))
		walls.push(new Wall(x = -9, z = 15, width = 2, length = 4, "white"))
		walls.push(new Wall(x = 18, z = 5, width = 2, length = 31, "pink"))
		walls.push(new Wall(x = 2, z = 20, width = 35, length = 2, "blue"))

enemies.push(new Enemy(x=0, z=-3.5, v=0.01, direction="x", range=1.5, rotation=0))

		//keyboard toggle between birdseye view and street view
		document.addEventListener('keydown', function(event) {
			//return (enter) key
			if(event.keyCode == 13) {
				birdseye = !birdseye
				//console.log(birdseye)
			}
		});

		//start game loop below
		loop()
	}



	//game loop 
	function loop() {

		for (let wall of walls) {
			wall.blocksYou()
		}
		
		for (let enemy of enemies) {
		enemy.move()
		}
		
		text.setAttribute("value", `${Math.round(cameraPos.x)} , ${Math.round(cameraPos.z)}`)
		


		if (birdseye==true) {
			//position and rotate camera to a view from above
			camera.setAttribute("position", `${cameraPos.x} 14 ${cameraPos.z}`)
			camera.components["look-controls"].pitchObject.rotation.x = -Math.PI/2
			camera.setAttribute("look-controls", "mouseEnabled:false")
		}
		else if (birdseye==false) {
			//position and rotate camera back into street view
			camera.setAttribute("position", `${cameraPos.x} 1.6 ${cameraPos.z}`)
			camera.components["look-controls"].pitchObject.rotation.x = 0
			camera.setAttribute("look-controls", "mouseEnabled:true")
		}

		setTimeout(loop, 10)

	}




	//TYPES OF OBJECTS

	class Wall {
		constructor(x, z, width, length, color) {
			this.x = x
			this.z = z
			this.width = width
			this.length = length
			this.obj = document.createElement("a-box")
			this.obj.setAttribute("scale", `${width} 2 ${length}`)
			this.obj.setAttribute("position", `${x} 1 ${z}`)
			this.obj.setAttribute("color", color)

			scene.append(this.obj)
		}

		blocksYou() {
			let bump = 0.45

			//z direction blocking
			if (cameraPos.x < this.x + this.width / 2 && cameraPos.x > this.x - this.width / 2) {
				if (cameraPos.z < this.z + this.length / 2 + bump && cameraPos.z > this.z + this.length / 2) {
					camera.setAttribute("position", { x: cameraPos.x, y: cameraPos.y, z: cameraPos.z + bump })
				}
				else if (cameraPos.z < this.z - this.length / 2 && cameraPos.z > this.z - this.length / 2 - bump) {
					camera.setAttribute("position", { x: cameraPos.x, y: cameraPos.y, z: cameraPos.z - bump })
				}
			}

			//x direction blocking 
			if (cameraPos.z < this.z + this.length / 2 && cameraPos.z > this.z - this.length / 2) {
				if (cameraPos.x < this.x + this.width / 2 + bump && cameraPos.x > this.x + this.width / 2) {
					camera.setAttribute("position", { x: cameraPos.x + bump, y: cameraPos.y, z: cameraPos.z })
				}
				else if (cameraPos.x < this.x - this.width / 2 && cameraPos.x > this.x - this.width / 2 - bump) {
					camera.setAttribute("position", { x: cameraPos.x - bump, y: cameraPos.y, z: cameraPos.z })
				}
			}
		}
	}



class Enemy {
	constructor(x,z,v,direction,range,rotation) {
		this.x = x
		this.z = z
		this.originalX = x
		this.originalZ = z
		this.width = 0.25
		this.length = 0.25
		this.velocity = v
		this.direction = direction
		this.range = range
		this.rotation = rotation
		//this.obj = document.createElement("a-box")
		this.obj = document.createElement("a-entity")
		const body = document.createElement("a-cylinder")
		body.setAttribute("color", "rgb(155,100,100)")
		body.setAttribute("scale", `${this.width} 1.5 ${this.length}`)
		const leftEye = document.createElement("a-sphere")
		leftEye.setAttribute("color", "rgb(0,0,0)")
		leftEye.setAttribute("scale", `0.05 0.05 0.05`)
		leftEye.setAttribute("position", `0.1 0.5 0.25`)
		const rightEye = document.createElement("a-sphere")
		rightEye.setAttribute("color", "rgb(0,0,0)")
		rightEye.setAttribute("scale", `0.05 0.05 0.05`)
		rightEye.setAttribute("position", `-0.1 0.5 0.25`)
		const eyebrows = document.createElement("a-circle")
		eyebrows.setAttribute("color", "rgb(0,0,0)")
		eyebrows.setAttribute("scale", `0.15 0.1 0.2`)
		eyebrows.setAttribute("rotation", "20 0 0")
		eyebrows.setAttribute("position", `0 0.25 0.22`)
		this.obj.appendChild(body)
		this.obj.appendChild(leftEye)
		this.obj.appendChild(rightEye)
		this.obj.appendChild(eyebrows)
		this.obj.setAttribute("rotation", `0 ${this.rotation} 0`)
		this.obj.setAttribute("position", `${this.x} 0.75 ${this.z}`)
		//this.obj.setAttribute("src", "evil.png")
		this.obj.setAttribute("color", "rgb(155,100,100)")
		scene.append(this.obj)
	}


	move() {
		if (this.direction == "x") { 
		  this.x = this.x + this.velocity
		  if (this.x > this.originalX + this.range/2) {
			  this.velocity = this.velocity * -1
		  }
		  else if (this.x < this.originalX - this.range/2) {
			  this.velocity = this.velocity * -1
		  }
		}
		else if (this.direction == "z") { 
		  this.z = this.z + this.velocity
		  if (this.z > this.originalZ + this.range/2) {
			  this.velocity = this.velocity * -1
		  }
		  else if (this.z < this.originalZ - this.range/2) {
			  this.velocity = this.velocity * -1
		  }
		}
		this.obj.setAttribute("position", `${this.x} 0.75 ${this.z}`)
	}

	resetsYou() {
		let bump = 0.25

		//z direction reset
		if (cameraPos.x<this.x+this.width/2 && cameraPos.x>this.x-this.width/2) {
			if (cameraPos.z<this.z+this.length/2+bump && cameraPos.z>this.z+this.length/2) {
				camera.setAttribute("position", {x:originalX, y:cameraPos.y, z:originalZ})
				reactionToEnemy()
			}
			else if (cameraPos.z<this.z-this.length/2 && cameraPos.z>this.z-this.length/2-bump) {
				camera.setAttribute("position", {x:originalX, y:cameraPos.y, z:originalZ})
				reactionToEnemy()
			}
		}

		//x direction reset 
		if (cameraPos.z<this.z+this.length/2 && cameraPos.z>this.z-this.length/2) {
			if (cameraPos.x<this.x+this.width/2+bump && cameraPos.x>this.x+this.width/2) {
				camera.setAttribute("position", {x:originalX, y:cameraPos.y, z:originalZ})
				reactionToEnemy()
			}
			else if (cameraPos.x<this.x-this.width/2 && cameraPos.x>this.x-this.width/2-bump) {
				camera.setAttribute("position", {x:originalX, y:cameraPos.y, z:originalZ})
				reactionToEnemy()
			}
		}

	}

}

function reactionToEnemy() {
	text.setAttribute("value", "ouch!")
	setTimeout(function(){
		text.setAttribute("value", "")
	}, 500);
}


	</script>
  
</body>

</html>